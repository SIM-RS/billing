<?php
	session_start();
	$userId = $_SESSION['userId'];
	$date_now=gmdate('d-m-Y',mktime(date('H')+7));
	$date_skr=explode('-',$date_now);
	
?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link type="text/css" rel="stylesheet" href="../../theme/mod.css">
<script language="JavaScript" src="../../theme/js/dsgrid.js"></script>

<!--dibawah ini diperlukan untuk menampilkan popup-->
<link rel="stylesheet" type="text/css" href="../../theme/popup.css" />
<script type="text/javascript" src="../../theme/prototype.js"></script>
<script type="text/javascript" src="../../theme/effects.js"></script>
<script type="text/javascript" src="../../theme/popup.js"></script>
<!--diatas ini diperlukan untuk menampilkan popup-->

<!-- untuk ajax-->
<script type="text/javascript" src="../../theme/js/ajax.js"></script>
<!-- end untuk ajax-->

<title>Laporan Pelaksana Layanan</title>
</head>

<body>
<script>
	var arrRange=depRange=[];
</script>
<iframe height="193" width="168" name="gToday:normal:agenda.js"
	id="gToday:normal:agenda.js"
	src="../../theme/popcjs.php" scrolling="no"
	frameborder="1"
	style="border:1px solid medium ridge; position: absolute; z-index: 65535; left: 100px; top: 50px; visibility: hidden">
</iframe>
<div align="center">
<?php
	include("../../header1.php");
	include("../../koneksi/konek.php");
	include("report_form.php");
	$date_now=gmdate('d-m-Y',mktime(date('H')+7));
?>
<table width="1000" border="0" cellpadding="0" cellspacing="0" class="hd2">
	<tr>
		<td height="30">&nbsp;LAPORAN PELAKSANA LAYANAN</td>
	</tr>
</table>
<table width="1000" border="0" cellspacing="0" cellpadding="0" class="txtinput" align="center" height="450">
	<tr>
		<td width="15%" height="50">&nbsp;</td>
		<td width="70%">&nbsp;</td>
		<td width="15%">&nbsp;</td>
	</tr>
	<tr>
		<td>&nbsp;</td>
		<td valign="top">
			<table width="100%" border="0" cellpadding="2" cellspacing="5" align="center" style="border:solid 5px #339900;background-color:#D3EFBA;font-size:14px">
				<tr>
					<td style="line-height:30px;">
						 <ol>
                         	<li><a href="javascript:void(0)" onclick="popupReport2();variabel=1;sts=1;tipe=1;change()">Rekap Pendapatan Jasa Pelaksana</a></li>
						 	<li><a href="javascript:void(0)" onclick="popupReport1();variabel=0;sts=1;tipe=0;change()">Rekap Penghitungan Jasa Pelaksana</a></li>
                            <li><a href="javascript:void(0)" onclick="popupReport3();variabel=1;sts=1;tipe=1;change()">Rincian jasa pelayanan (retribusi) sesuai komponen tarif</a></li>
                            <li><a href="javascript:void(0)" onclick="popupReport4();variabel=1;sts=1;tipe=1;change()">Rincian jasa pelayanan (visite) sesuai komponen tarif</a></li>
						 </ol>
					</td>
				</tr>
			</table>
		</td>
		<td>&nbsp;</td>
	</tr>
	<tr>
		<td colspan="3" height="50">&nbsp;</td>
	</tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="1000" class="hd2">
  <tr height="30">
  	<td>&nbsp;</td>
	<td>&nbsp;</td>
	<td>&nbsp;</td>
  </tr>
</table>
</div>
</body>
<?php
echo $sql="SELECT
  b.id,
  b.kode,
  b.nama,
  b.username,
  a.ms_group_id
FROM b_ms_group_petugas a
  INNER JOIN billing.b_ms_pegawai b
    ON a.ms_pegawai_id = b.id
WHERE b.id = '".$_SESSION['userId']."'";
	$cekuser=mysql_query($sql);
	$group=mysql_fetch_array($cekuser);
	$user=$group['ms_group_id'];
?>
<script>
	isiCombo('JnsLayanan','','','',showTmpLay);
	isiCombo1('StatusPas');
	function showTmpLay(){
		isiCombo('TmpLayanan',document.getElementById('JnsLayanan').value,'','',showPel);
		isiCombo1('cmbKsr',document.getElementById('JnsLayanan').value);
	}
	
	function showPel(){
		var user = '<?php echo $user ?>';
		//isiCombo('cmbDokJns',document.getElementById('TmpLayanan').value);
		if(user==43){
			document.getElementById('cmbDokJns').value='<?php echo $userId; ?>';
			document.getElementById('cmbDokSemua').value='<?php echo $userId; ?>';
		}
	}
	
	isiCombo1('JnsLayananBaru','','','',showTmpLaySemua);
	function showTmpLaySemua(){
		isiCombo1('TmpLayananBaru',document.getElementById('JnsLayananBaru').value,'','',showDok);
	}
	
	function showDok(){
		isiCombo('cmbDokSemua',document.getElementById('TmpLayananBaru').value);
		if(user==43){
			isiCombo('cmbDokSemua',document.getElementById('TmpLayananBaru').value,<?php echo $userId; ?>);
			//document.getElementById('cmbDokJns').value='<?php echo $userId; ?>';
			//document.getElementById('cmbDokSemua').value='<?php echo $userId; ?>';
		}
	}
	
	isiCombo('JnsLayananPav','','','',showTmpLayPav);
	function showTmpLayPav(){
		isiCombo('TmpLayananPav',document.getElementById('JnsLayananPav').value);
		isiCombo('TmpLayananPavInap',document.getElementById('JnsLayananPav').value);
	}
	
	
	
	var variabel;
	var sts;
	var tipe;
	function change()
	{
		//alert(variabel);
		if(variabel==1)
		{
			isiCombo1('TmpLayanan',document.getElementById('JnsLayanan').value,'','',showPel);
			isiCombo1('TmpLayananBaru',document.getElementById('JnsLayananBaru').value,'','',showDok);
			isiCombo1('TmpLayananPav',document.getElementById('JnsLayananPav').value);
			isiCombo1('TmpLayananPavInap',document.getElementById('JnsLayananPav').value);
		}
		else{
			isiCombo('TmpLayanan',document.getElementById('JnsLayanan').value);
			isiCombo('TmpLayananBaru',document.getElementById('JnsLayananBaru').value,'','',showDok);
			isiCombo('TmpLayananPav',document.getElementById('JnsLayananPav').value);
			isiCombo('TmpLayananPavInap',document.getElementById('JnsLayananPav').value);
		}
		if(sts==1)
		{
			isiCombo1('StatusPas');
		}
		else
		{
			isiCombo('StatusPas');
		}
		if(tipe==0)
		{
			document.getElementById('rwJnsLay').style.display = 'table-row';
			document.getElementById('rwTmpLay').style.display = 'table-row';
			document.getElementById('rwJnsLayBr').style.display = 'none';
			document.getElementById('rwTmpLayBr').style.display = 'none';
			document.getElementById('rwPelaksana').style.display = 'none';
			document.getElementById('rwPelaksanaDok').style.display = 'none';
			document.getElementById('trPenjamin').style.display = 'table-row';
			document.getElementById('trPel').style.display = 'none';
			document.getElementById('JnsPav').style.display = 'none';
			document.getElementById('TmpPav').style.display = 'none';
			document.getElementById('TmpPavInap').style.display = 'none';
		}
		else if(tipe==1)
		{
			document.getElementById('rwJnsLay').style.display = 'none';
			document.getElementById('rwTmpLay').style.display = 'none';
			document.getElementById('rwJnsLayBr').style.display = 'table-row';
			document.getElementById('rwTmpLayBr').style.display = 'table-row';
			document.getElementById('rwPelaksana').style.display = 'none';
			document.getElementById('rwPelaksanaDok').style.display = 'table-row';
			document.getElementById('trPenjamin').style.display = 'table-row';
			document.getElementById('trPel').style.display = 'none';
			document.getElementById('JnsPav').style.display = 'none';
			document.getElementById('TmpPav').style.display = 'none';
			document.getElementById('TmpPavInap').style.display = 'none';
		}
		else if(tipe==2)
		{
			document.getElementById('rwJnsLay').style.display = 'none';
			document.getElementById('rwTmpLay').style.display = 'none';
			document.getElementById('rwJnsLayBr').style.display = 'none';
			document.getElementById('rwTmpLayBr').style.display = 'none';
			document.getElementById('rwPelaksana').style.display = 'none';
			document.getElementById('rwPelaksanaDok').style.display = 'none';
			document.getElementById('trPenjamin').style.display = 'table-row';
			document.getElementById('trPel').style.display = 'none';
			document.getElementById('JnsPav').style.display = 'table-row';
			document.getElementById('TmpPav').style.display = 'table-row';
			document.getElementById('TmpPavInap').style.display = 'none';
		}
		else if(tipe==3)
		{
			document.getElementById('rwJnsLay').style.display = 'none';
			document.getElementById('rwTmpLay').style.display = 'none';
			document.getElementById('rwJnsLayBr').style.display = 'none';
			document.getElementById('rwTmpLayBr').style.display = 'none';
			document.getElementById('rwPelaksana').style.display = 'none';
			document.getElementById('rwPelaksanaDok').style.display = 'none';
			document.getElementById('trPenjamin').style.display = 'table-row';
			document.getElementById('trPel').style.display = 'none';
			document.getElementById('JnsPav').style.display = 'table-row';
			document.getElementById('TmpPav').style.display = 'none';
			document.getElementById('TmpPavInap').style.display = 'table-row';
		}
		else
		{
			document.getElementById('rwJnsLay').style.display = 'none';
			document.getElementById('rwTmpLay').style.display = 'none';
			document.getElementById('rwJnsLayBr').style.display = 'none';
			document.getElementById('rwTmpLayBr').style.display = 'none';
			document.getElementById('rwPelaksana').style.display = 'table-row';
			document.getElementById('rwPelaksanaDok').style.display = 'none';
			document.getElementById('trPenjamin').style.display = 'none';
			document.getElementById('trPel').style.display = 'none';
			document.getElementById('JnsPav').style.display = 'table-row';
			document.getElementById('TmpPav').style.display = 'none';
			document.getElementById('TmpPavInap').style.display = 'table-row';
		}
	}
	
		
	function isiCombo(id,val,defaultId,targetId,evloaded)
	{
		if(targetId=='' || targetId==undefined)
		{
			targetId=id;
		}
			Request('../../combo_utils.php?id='+id+'&value='+val+'&defaultId='+defaultId,id,'','GET',evloaded);
	}
	function isiCombo1(id,val,defaultId,targetId,evloaded)
	{
		if(targetId=='' || targetId==undefined)
		{
			targetId=id;
		}
			Request('../../combo_utils.php?id='+id+'&value='+val+'&all=1&defaultId='+defaultId,id,'','GET',evloaded);
	}
	
	function ubah()
	{
		if(document.getElementById('cmbWaktu').value=="Harian")
		{
			document.getElementById('tglAwal').value = document.getElementById('tglAwal2').value;
			document.getElementById('tglAkhir').value = document.getElementById('tglAwal2').value;
		}
	}
	
	function setBln(val)
	{
		if(val=='Harian')
		{
			document.getElementById('trBulan').style.display = "none";
			document.getElementById('trPeriode').style.display = "none";
			//document.getElementById('tglAwal').value = '<?=$date_now?>';
			//document.getElementById('tglAkhir').value = '<?=$date_now?>';
			document.getElementById('trHarian').style.display = "block";
		}
		else if(val=='Bulanan')
		{
			document.getElementById('trBulan').style.display = "block";
			document.getElementById('trPeriode').style.display = "none";
			document.getElementById('trHarian').style.display = "none";
			document.getElementById('cmbBln').innerHTML =
			'<option value="01">Januari</option>'+
			'<option value="02">Februari</option>'+
			'<option value="03">Maret</option>'+
			'<option value="04">April</option>'+
			'<option value="05">Mei</option>'+
			'<option value="06">Juni</option>'+
			'<option value="07">Juli</option>'+
			'<option value="08">Agustus</option>'+
			'<option value="09">September</option>'+
			'<option value="10">Oktober</option>'+
			'<option value="11">Nopember</option>'+
			'<option value="12">Desember</option>';
			var thSkr='<?php echo $date_skr[2];?>';
			var thAwal=thSkr*1-5;
			var thAkhir=thSkr*1+6;
			for(thAwal;thAwal<thAkhir;thAwal++)
			{				
				document.getElementById('cmbThn').innerHTML = 
				document.getElementById('cmbThn').innerHTML+'<option>'+thAwal+'</option>';
			}
			document.getElementById('cmbBln').value = '<?php echo $date_skr[1];?>';
			document.getElementById('cmbThn').value = thSkr;
		}
		else if(val=='Rentang Waktu')
		{
			document.getElementById('trPeriode').style.display = "block";
			document.getElementById('trBulan').style.display = "none";
			document.getElementById('trHarian').style.display = "none";
		}
		else
		{
			document.getElementById('trPeriode').style.display = "none";
			document.getElementById('trBulan').style.display = "none";
			document.getElementById('trHarian').style.display = "none";
		}
	}
	
	function bulanan()
	{
		var bulan = document.getElementById("cmbBln").value;
		var tahun = document.getElementById("cmbThn").value;
		var akhir;
		document.getElementById("tglAwal").value = '01-'+bulan+'-'+tahun;
		if(bulan == 2)
		{
			if((tahun%4 == 0) && (tahun%100 != 0))
			{
				akhir = 29;
			}
			else
			{
				akhir = 28;
			}
		}
		else if(bulan<=7)
		{
			if(bulan%2 == 0)
			{
				akhir = 30;
			}
			else
			{
				akhir = 31;
			}
		}
		else if(bulan>7)
		{
			if(bulan%2 == 0)
			{
				akhir = 31;
			}
			else
			{
				akhir = 30;
			}
		}
		document.getElementById("tglAkhir").value = akhir+'-'+bulan+'-'+tahun;
	}
	
	function popupReport1()
	{
		new Popup('popup_div1',null,{modal:true,position:'center',duration:0.5})
		$('popup_div1').popup.show();
		document.getElementById('form1').action='japel.php';
	}
	
	
	function popupReport2()
	{
		new Popup('popup_div1',null,{modal:true,position:'center',duration:0.5})
		$('popup_div1').popup.show();
		document.getElementById('form1').action='pendapatan.php';
	}
	
	function popupReport3()
	{
		new Popup('popup_div1',null,{modal:true,position:'center',duration:0.5})
		$('popup_div1').popup.show();
		document.getElementById('form1').action='retribusi.php';
	}
	
	function popupReport4()
	{
		new Popup('popup_div1',null,{modal:true,position:'center',duration:0.5})
		$('popup_div1').popup.show();
		document.getElementById('form1').action='visite.php';
	}
	
</script>
</html>